# Pelago Payment for WooCommerce 사용 가이드

## 플러그인 개요

Pelago Payment for WooCommerce는 WordPress WooCommerce 스토어를 위해 특별히 설계된 디지털 결제 플러그인으로, Pelago의 디지털 QR 코드 결제 방식을 통한 온라인 결제를 지원합니다.

## 시스템 요구사항

- WordPress 5.0 이상
- WooCommerce 3.0 이상
- PHP 7.4 이상
- SSL 인증서 (프로덕션 환경에서 권장)

## 설치 단계

### 방법 1: 수동 폴더 업로드

전체 `pelagopay-gateway` 폴더를 WordPress 웹사이트의 `/wp-content/plugins/` 디렉토리에 업로드합니다.

### 방법 2: WordPress 관리자에서 ZIP 파일 업로드

1. GitHub Release에서 최신 `pelagopay-gateway.zip` 파일 다운로드:
   - 플러그인의 GitHub 저장소 방문
   - **Releases** 탭 클릭
   - 최신 tag 버전 선택
   - `pelagopay-gateway.zip` 파일 다운로드
2. WordPress 관리자 대시보드에 로그인
3. **플러그인** > **새로 추가**로 이동
4. **플러그인 업로드** 버튼 클릭
5. 다운로드한 `pelagopay-gateway.zip` 파일을 선택하고 **지금 설치** 클릭
6. 설치 완료 후 **플러그인 활성화** 클릭

### 플러그인 활성화 (방법 1 사용시)

1. WordPress 관리자 대시보드에 로그인
2. **플러그인** > **설치된 플러그인**으로 이동
3. "Pelago Payment for WooCommerce" 플러그인 찾기
4. **활성화** 버튼 클릭

### 3. 종속성 확인

플러그인은 WooCommerce가 설치되고 활성화되어 있는지 자동으로 확인합니다. WooCommerce가 설치되지 않았거나 활성화되지 않은 경우 해당 알림 메시지가 표시됩니다.

## 구성 설정

### 1. 결제 설정 접근

1. WordPress 관리자에서 **WooCommerce** > **설정**으로 이동
2. **결제** 탭 클릭
3. **Pelago Payment** 옵션 찾기

### 2. 기본 설정

#### 활성화/비활성화
- **Pelago Payment 활성화**: Pelago 결제 방식을 활성화하려면 이 옵션을 체크

#### 표시 설정
- **제목**: 고객이 체크아웃 페이지에서 볼 결제 방식 이름
  - 기본값: `Pelago Payment`
- **설명**: 고객이 체크아웃 페이지에서 볼 결제 방식 설명
  - 기본값: `Pay with Pelago's digital QR Code payment method.`
- **안내사항**: 감사 페이지와 주문 이메일에 추가될 안내사항

### 3. API 구성 (중요)

다음 구성 항목들은 플러그인이 정상적으로 작동하기 위해 필요한 매개변수입니다. Pelago에 연락하여 획득하세요:

#### merchantId
- **설명**: 귀하의 PelagoPay 상점 ID
- **획득 방법**: Pelago 상점 대시보드에서 획득

#### appKey  
- **설명**: 귀하의 PelagoPay 애플리케이션 키
- **획득 방법**: Pelago 상점 대시보드에서 획득

#### merchantPrikey
- **설명**: 상점 개인키, 서명 검증에 사용
- **보안 참고**: 안전하게 보관하고 타인에게 노출하지 마세요

#### platformPublicKey
- **설명**: 플랫폼 공개키, 콜백 서명 검증에 사용
- **획득 방법**: Pelago의 기술 문서에서 획득

### 4. 테스트 모드

- **테스트 모드 활성화**: 테스트 환경을 사용하려면 이 옵션을 체크
  - 테스트 환경 API: `https://pgpay-stage.weroam.xyz` 및 `https://stage-api.pelagotech.com`
  - 프로덕션 환경 API: `https://pgpay.weroam.xyz` 및 `https://api.pelagotech.com`

## 사용 흐름

### 1. 고객 결제 흐름

1. 고객이 스토어에서 상품을 선택하고 장바구니에 추가
2. 체크아웃 페이지에서 결제 방식으로 "Pelago Payment" 선택
3. "주문하기" 버튼 클릭
4. 시스템이 자동으로 통화 변환 수행 (USD로 변환)
5. 고객이 Pelago 결제 페이지로 리디렉션
6. 고객이 QR 코드를 사용하여 결제 완료
7. 결제 완료 후 자동으로 주문 확인 페이지로 돌아감

### 2. 주문 상태 관리

플러그인은 Pelago 콜백을 기반으로 자동으로 주문 상태를 업데이트합니다:

- **결제 성공**: 주문 상태가 "처리 중"으로 업데이트
- **결제 타임아웃**: 주문 상태가 "실패"로 업데이트
- **결제 취소**: 주문 상태가 "취소됨"으로 업데이트
- **부분 결제**: 주문 상태가 "실패"로 업데이트
- **초과 결제**: 주문 상태가 "처리 중"으로 업데이트

## 콜백 URL 구성 (선택사항)

플러그인은 다음 형식으로 콜백 URL을 자동 생성합니다:
```
https://yourdomain.com/?wc-api=wc_pelagopay_gateway
```

이 URL을 Pelago 기술 지원팀에 제공하여 구성하도록 하세요.
주문 시 콜백 링크가 주문과 함께 제출되며, Pelago는 결제 성공 후 이 링크를 호출합니다.

## 통화 지원

- 플러그인은 여러 통화를 지원하며 주문 금액을 자동으로 USD로 변환하여 결제를 진행합니다
- 지원되는 통화는 귀하의 WooCommerce 설정과 Pelago의 환율 서비스에 따라 결정됩니다

## 로그 기록

플러그인에는 상세한 로그 기록 기능이 포함되어 있습니다:
- 테스트 모드에서는 상세한 디버그 정보를 기록
- 프로덕션 모드에서는 주요 작업과 오류 정보를 기록
- 로그는 결제 문제 해결에 도움이 됩니다

## 보안 기능

- **서명 검증**: 모든 API 요청과 콜백에서 RSA 서명 검증 사용
- **데이터 암호화**: 민감한 데이터 전송에 HTTPS 암호화 사용
- **재생 공격 방지**: 타임스탬프와 난수를 사용하여 재생 공격 방지

## 문제 해결

### 일반적인 문제

1. **결제 페이지에 접근할 수 없음**
   - API 구성이 올바른지 확인
   - 네트워크 연결이 정상인지 확인
   - SSL 인증서가 유효한지 검증

2. **콜백 실패**
   - 콜백 URL이 올바르게 구성되었는지 확인
   - 서버가 외부 요청을 받을 수 있는지 확인
   - 서명 구성이 올바른지 검증

3. **통화 변환 실패**
   - 네트워크 연결 확인
   - 통화 코드 형식이 올바른지 확인
   - 기술 지원에 연락하여 환율 서비스 확인

### 디버깅 단계

1. 디버깅을 위해 테스트 모드 활성화
2. WordPress 오류 로그 확인
3. Pelago 기술 지원에 연락하여 도움 받기

## 기술 지원

기술 지원이 필요한 경우 다음으로 연락하세요:
- **Pelago 웹사이트**: https://pelagotech.com
- **기술 지원**: 공식 채널을 통해 연락하세요

## 버전 정보

- **현재 버전**: 2.0.0
- **호환성**: WooCommerce 3.0+
- **업데이트 날짜**: 최신 정보는 플러그인 파일을 확인하세요

## 중요 사항

1. 프로덕션 환경에서 사용하기 전에 모든 기능을 충분히 테스트하세요
2. 웹사이트 데이터를 정기적으로 백업하세요
3. 플러그인과 WordPress 시스템을 최신 버전으로 유지하세요
4. API 키와 개인키 정보를 적절히 보호하세요
5. SSL 환경에서 이 플러그인을 사용하는 것을 권장합니다
